(()=>{"use strict";var e=function(e,t,n,o){var c=e.querySelector(".places__item").cloneNode(!0),r=c.querySelector(".card__title"),a=c.querySelector(".card__image"),i=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-reactions");r.textContent=t.name,a.src=t.link,a.alt=t.name;var s=o.id;return c.setAttribute("id","".concat(t._id)),l.textContent=t.likes.length,n.cardLikeMyReactions(t,s,u,n),u.addEventListener("click",(function(){u.classList.contains("card__like-button_is-active")?n.deleteCardLike(t._id).then((function(e){l.textContent=e.likes.length,n.toggleCardLike(u)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})):n.putAddCardLike(t._id).then((function(e){l.textContent=e.likes.length,n.toggleCardLike(u)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))})),t.owner._id===s?i.addEventListener("click",(function(){n.cardDelete(t._id,c)})):i.remove(),a.addEventListener("click",(function(){n.populatePopupImage(r.textContent,a.src)})),c};function t(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function n(e){"Escape"===e.key&&o(document.querySelector(".popup_is-opened"))}function o(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}var c=function(e,t){var n=e.querySelector(t.submitButtonSelector),o=Array.from(e.querySelectorAll(t.inputSelector));(function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))})(o,n,t),o.forEach((function(n){!function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}(e,n,t)}))},r={baseUrl:"https://nomoreparties.co/v1/pwff-cohort-1",headers:{authorization:"c781ff1a-30f1-4e19-b0bb-300048dada70","Content-Type":"application/json"}};function a(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var i=document.querySelector("#card-template").content,u=document.querySelector(".places__list"),l=document.querySelector(".profile__info"),s=document.querySelector(".profile__title"),d=document.querySelector(".profile__description"),p=document.querySelector(".profile__image"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),m=document.querySelectorAll(".popup"),h=document.querySelector(".popup_type_edit"),v=document.querySelector(".popup_type_edit-avatar-profile"),y=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),k=b.querySelector(".popup__image"),S=b.querySelector(".popup__caption"),g=document.querySelector(".popup_type_delete-card"),C=g.querySelector(".popup__button"),L=document.forms.editProfile,q=L.elements.name,E=L.elements.description,x=document.forms.newAvatarProfile,P=x.elements.link,A=document.forms.newPlace,U=A.elements.placeName,w=A.elements.link,D={cardDelete:function(e,n){t(g),C.onclick=function(){return I(e,n)}},cardLikeMyReactions:function(e,t,n,o){e.likes.some((function(e){return e._id===t}))&&o.toggleCardLike(n)},toggleCardLike:function(e){e.classList.toggle("card__like-button_is-active")},populatePopupImage:function(e,n){k.src=n,k.alt=e,S.textContent=e,t(b)},openPopup:t,closePopup:o,putAddCardLike:function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then(a)},deleteCardLike:function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then(a)}},T={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Promise.all([fetch("".concat(r.baseUrl,"/cards"),{headers:r.headers}).then(a),fetch("".concat(r.baseUrl,"/users/me"),{headers:r.headers}).then(a)]).then((function(t){var n=[t[0],t[1]],o=n[0],c=n[1];l.setAttribute("id","".concat(c._id)),o.forEach((function(t){N(u,e(i,t,D,l))})),B(c)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}));var B=function(e){s.textContent=e.name,d.textContent=e.about,p.style.backgroundImage="url(".concat(e.avatar,")")};function N(e,t){"prepend"===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"append")?e.prepend(t):e.append(t)}var I=function(e,t){(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then(a)})(e).then((function(){t.remove(),o(g)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))}))},O=function(e,t){e.querySelector(".popup__button").textContent=t?"Сохранение...":"Сохранить"};f.addEventListener("click",(function(){c(L,T),q.value=s.textContent,E.value=d.textContent,t(h)})),_.addEventListener("click",(function(){A.reset(),c(A,T),t(y)})),L.addEventListener("submit",(function(e){var t;e.preventDefault(),O(L,!0),(t={name:q.value,about:E.value},fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify(t)}).then(a)).then((function(e){s.textContent=e.name,d.textContent=e.about,o(h)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){O(L,!1)}))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),O(x,!0),(t=P.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){p.style.backgroundImage="url(".concat(e.avatar,")"),o(v)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){O(x,!1)}))})),p.addEventListener("click",(function(){x.reset(),c(x,T),t(v)})),A.addEventListener("submit",(function(t){var n;t.preventDefault(),O(A,!0),(n={name:U.value,link:w.value},fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify(n)}).then(a)).then((function(t){N(u,e(i,t,D,l),"prepend"),o(y)})).catch((function(e){return console.log("Ошибка.....: ".concat(e))})).finally((function(){O(A,!1)}))})),m.forEach((function(e){var t=e.querySelector(".popup__close");e.addEventListener("click",(function(n){n.target!==e&&n.target!==t||o(e)}))}))})();